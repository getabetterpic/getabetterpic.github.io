---
layout: post
title: Credit Card Number Validation in VBA
date: '2012-08-23T10:48:00.001-04:00'
author: Daniel Smith
tags: 
modified_time: '2012-08-23T10:48:33.648-04:00'
blogger_id: tag:blogger.com,1999:blog-358950712929443967.post-1204031623052952471
blogger_orig_url: http://www.getabetterpic.com/2012/08/credit-card-number-validation-in-vba.html
---

In my last post, I mentioned that I created a way to validate that a credit card number was valid. I use valid here in the sense that it conforms to actual numbers issued by the credit card companies. It does not actually check to see if the card has been issued to someone. The majority of this was adapted from <a href="http://adywicaksono.wordpress.com/2008/02/17/how-to-validate-credit-card-number/">here</a>&nbsp;where Ady Wicaksono explains in detail how it works, and a javascript implementation of it. The below code was my adaptation of that logic to VBA to validate a card number entered into an Excel dialog box.<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> Function isValidCard(inCC)  <br />   Dim intStartDb As Integer  <br />   Dim intStartNon As Integer  <br />     <br />   ' remove any non-numeric characters, such as dashes  <br />     <br />   If Mid(inCC, 1, 1) Like "[0-2,7-8]" Then GoTo ValidCardFalse  <br />     <br />   For i = 1 To Len(inCC)  <br />     If Mid(inCC, i, 1) Like "[0-9]" Then inCCClean = inCCClean &amp; Mid(inCC, i, 1)  <br />   Next  <br />     <br />   If Len(inCCClean) &lt; 11 Then  <br />     GoTo ValidCardFalse  <br />   End If  <br />     <br />   intDouble = 0  <br />     <br />   If CInt(Len(inCCClean) / 2) = Len(inCCClean) / 2 Then  <br />     intStartDb = 1  <br />     intStartNon = 2  <br />   Else  <br />     intStartDb = 2  <br />     intStartNon = 1  <br />   End If  <br />     <br />   i = 0  <br />   For i = intStartDb To Len(inCCClean) Step 2  <br />     intCheck = CInt(Mid(inCCClean, i, 1)) * 2  <br />     If intCheck &gt; 9 Then intCheck = intCheck - 9  <br />     intDouble = intDouble + intCheck  <br />   Next  <br />     <br />   i = 0  <br />   intNonDoub = 0  <br />   For i = intStartNon To Len(inCCClean) Step 2  <br />     intNonDoub = intNonDoub + CInt(Mid(inCCClean, i, 1))  <br />   Next  <br />     <br />   intAddCheck = intDouble + intNonDoub  <br />     <br />   If (intAddCheck / 10) = CInt(intAddCheck / 10) Then  <br />     isValidCard = inCCClean  <br />   Else  <br />     GoTo ValidCardFalse  <br />   End If  <br />     <br /> If isValidCard &lt;&gt; "" Then GoTo ValidCardTrue  <br />     <br /> ValidCardFalse:  <br /> isValidCard = ""  <br /> Exit Function  <br />   <br /> ValidCardTrue:  <br /> Exit Function  <br />     <br /> End Function  <br /></code></pre>